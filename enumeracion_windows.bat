@echo off

cls
cd ../../../../../../../
echo [101;93m#########################
echo # Enumerando el sistema #
echo #########################[0m
echo.
::dll hijacking?
::for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2>nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" && ECHO. )
::cmd /c ".\Documents\enumeracion_windows.bat"


echo [7mEnumerando Usuarios:[0m
echo -------------------
wmic useraccount get name,SID
echo.

echo [7mInformacion sobre el usaurio actual: "%USERNAME%"[0m
echo ----------------------------------------
whoami /all
echo.
echo "Grupos del usuario actual:"
net user %username% | findstr "memberships"
echo.

::echo [7mArchivos de la carpeta del usuario: "%USERPATH%"[0m
::echo -----------------------------------------
::tree %HOMEPATH%
::@timeout /t 7
::echo.

echo [7mListando Administradores:[0m
echo ---------------------------
net localgroup Administrators 2>nul
net localgroup Administradores 2>nul
echo.

echo [7mEnumerando servicios:[0m
echo ----------------------------------
wmic service get name, displayname, pathname, startmode | findstr /i "Auto" | findstr /i /v "C:\Windows\\"
echo.

echo [7mEnumerando servicios sin comillas (unquoted service):[0m
echo ----------------------------------------------------
wmic service get name, displayname, pathname, startmode | findstr /i "Auto" | findstr /i /v "C:\Windows\\" | findstr /i /v """
echo.

echo [7mHistorial de comandos en Powershell:[0m
echo ----------------------------------------------------
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
echo.

::echo [7mPosibles contraseÃ±as en archivos:[0m
::echo ----------------------------------
::findstr /si password *.xml *.ini *.txt *.config 2>nul 
::@timeout /t 7 > nul

echo [7mInformacion de Redes:[0m
echo ---------------------
ipconfig
echo.

echo [7mConexiones abiertas:[0m
echo --------------------
netstat -nat
echo. 

echo [7mAlways Install elevated?:[0m
echo --------------------
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated 2> nul
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated 2> nul
echo.

echo [7mBackups del SAM y el SYSTEM:[0m 
echo -----------------------------
IF EXIST %WINDIR%\repair\SAM ECHO.%WINDIR%\repair\SAM exists. 
IF EXIST %WINDIR%\System32\config\RegBack\SAM ECHO.%WINDIR%\System32\config\RegBack\SAM existe
IF EXIST %WINDIR%\System32\config\SAM ECHO.%WINDIR%\System32\config\SAM existe
IF EXIST %WINDIR%\repair\SYSTEM ECHO.%WINDIR%\repair\SYSTEM existe
IF EXIST %WINDIR%\System32\config\SYSTEM ECHO.%WINDIR%\System32\config\SYSTEM existe
IF EXIST %WINDIR%\System32\config\RegBack\SYSTEM ECHO.%WINDIR%\System32\config\RegBack\SYSTEM existe
echo.

echo [7mInformacion del sistema:[0m 
echo ------------------------
systeminfo

echo [7mGPPKeys[0m 
echo ------------------------
for /d %%x in ("C:\ProgramData\Microsoft\Group Policy\History\*") do set file=%%x
type "%file%\Machine\Preferences\Groups\Groups.xml" 2> nul


exit

::https://gist.githubusercontent.com/mlocati/fdabcaeb8071d5c75a2d51712db24011/raw/b710612d6320df7e146508094e84b92b34c77d48/win10colors.cmd
